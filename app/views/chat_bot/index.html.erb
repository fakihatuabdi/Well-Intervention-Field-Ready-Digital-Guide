<div class="fade-in w-full max-w-4xl mx-auto">
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-slate-800 mb-2">AI Chat Bot</h1>
    <p class="text-slate-600">Ask questions about well intervention operations and handbook content</p>
  </div>

  <!-- Chat Container -->
  <div class="bg-white rounded-2xl shadow-lg border elegant-border overflow-hidden">
    <!-- Chat Messages -->
    <div id="chat-messages" class="h-[500px] overflow-y-auto p-6 space-y-4 bg-gradient-to-br from-slate-50 to-sky-50/20">
      <% if @messages.any? %>
        <% @messages.each do |msg| %>
          <div class="<%= msg[:role] == 'user' ? 'flex justify-end' : 'flex justify-start' %> fade-in">
            <div class="<%= msg[:role] == 'user' ? 'bg-gradient-to-r from-sky-500 to-cyan-500 text-white' : 'bg-white text-slate-800 border elegant-border' %> rounded-2xl px-6 py-4 max-w-[80%] shadow-md hover-lift">
              <p class="text-sm"><%= msg[:content] %></p>
              <p class="text-xs <%= msg[:role] == 'user' ? 'text-sky-200' : 'text-slate-400' %> mt-2">
                <%= msg[:timestamp].strftime("%I:%M %p") %>
              </p>
            </div>
          </div>
        <% end %>
      <% else %>
        <!-- Welcome Message -->
        <div class="text-center py-12 scale-in">
          <div class="bg-gradient-to-br from-sky-100 to-cyan-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-sky-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-800 mb-2">Welcome to AI Chat Bot</h3>
          <p class="text-slate-600 mb-6">Ask me anything about well intervention operations</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 max-w-2xl mx-auto">
            <button class="suggestion-btn text-left p-4 bg-white hover:bg-gradient-to-r hover:from-sky-50 hover:to-cyan-50 rounded-xl border elegant-border transition-all duration-300 hover-lift">
              <p class="font-medium text-slate-800 text-sm">What are the safety procedures for drilling operations?</p>
            </button>
            <button class="suggestion-btn text-left p-4 bg-white hover:bg-gradient-to-r hover:from-sky-50 hover:to-cyan-50 rounded-xl border elegant-border transition-all duration-300 hover-lift">
              <p class="font-medium text-slate-800 text-sm">Explain the artificial lift methods</p>
            </button>
            <button class="suggestion-btn text-left p-4 bg-white hover:bg-gradient-to-r hover:from-sky-50 hover:to-cyan-50 rounded-xl border elegant-border transition-all duration-300 hover-lift">
              <p class="font-medium text-slate-800 text-sm">What is SIMOPS in well intervention?</p>
            </button>
            <button class="suggestion-btn text-left p-4 bg-white hover:bg-gradient-to-r hover:from-sky-50 hover:to-cyan-50 rounded-xl border elegant-border transition-all duration-300 hover-lift">
              <p class="font-medium text-slate-800 text-sm">Tell me about packer operations</p>
            </button>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Chat Input -->
    <div class="border-t border-sky-100 p-4 bg-white">
      <form id="chat-form" class="flex gap-2">
        <input 
          type="text" 
          id="message-input" 
          placeholder="Type your question here..."
          class="flex-1 px-4 py-3 rounded-xl border-2 border-slate-200 focus:border-sky-500 focus:ring-2 focus:ring-sky-200 outline-none transition-all duration-300"
          autocomplete="off"
        />
        <button 
          type="submit" 
          class="px-6 py-3 bg-gradient-to-r from-sky-500 to-cyan-500 hover:from-sky-600 hover:to-cyan-600 text-white font-semibold rounded-xl transition-all duration-300 flex items-center gap-2 shadow-lg hover:shadow-xl">
        >
          <span>Send</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
        </button>
      </form>
    </div>
  </div>

  <!-- Info Box -->
  <div class="mt-6 bg-gradient-to-r from-sky-50 to-cyan-50 border border-sky-200 rounded-xl p-6 elegant-border">
    <div class="flex items-start gap-3">
      <svg class="w-6 h-6 text-sky-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <div>
        <h4 class="font-semibold text-sky-900 mb-2">ðŸ¤– AI Integration Coming Soon</h4>
        <p class="text-sky-800 text-sm">
          This chat bot is currently in development. Soon it will be powered by an advanced AI engine that learns from 
          the handbook content and your previous questions to provide accurate, context-aware answers about well intervention operations.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const chatForm = document.getElementById('chat-form');
    const messageInput = document.getElementById('message-input');
    const chatMessages = document.getElementById('chat-messages');
    const suggestionBtns = document.querySelectorAll('.suggestion-btn');

    // Handle suggestion buttons
    suggestionBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const question = this.querySelector('p').textContent;
        messageInput.value = question;
        messageInput.focus();
      });
    });

    // Handle form submission
    chatForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const message = messageInput.value.trim();
      if (!message) return;

      // Add user message to chat
      addMessage(message, 'user');
      messageInput.value = '';

      // Send to server
      fetch('<%= chat_bot_send_message_path %>', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
        },
        body: JSON.stringify({ message: message })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          setTimeout(() => {
            addMessage(data.message, 'assistant');
          }, 500);
        }
      });
    });

    function addMessage(content, role) {
      const messageDiv = document.createElement('div');
      messageDiv.className = role === 'user' ? 'flex justify-end' : 'flex justify-start';
      
      const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
      
      messageDiv.innerHTML = `
        <div class="${role === 'user' ? 'bg-blue-600 text-white' : 'bg-white text-slate-800 border border-slate-200'} rounded-2xl px-6 py-4 max-w-[80%] shadow-sm">
          <p class="text-sm">${content}</p>
          <p class="text-xs ${role === 'user' ? 'text-blue-200' : 'text-slate-400'} mt-2">${time}</p>
        </div>
      `;
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  });
</script>
